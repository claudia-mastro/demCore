<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Generate full life table from abridged life table — abridged_to_full • lifetableUtils</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Generate full life table from abridged life table — abridged_to_full" />
<meta property="og:description" content="Convert abridged (5-year age group) life tables to full
(single-year-age) life tables using specified regression parameters or
lx spline" />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">lifetableUtils</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/introduction_to_life_tables.html">Introduction to life tables</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Generate full life table from abridged life table</h1>
    
    <div class="hidden name"><code>abridged_to_full.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Convert abridged (5-year age group) life tables to full
(single-year-age) life tables using specified regression parameters or
lx spline</p>
    </div>

    <pre class="usage"><span class='fu'>abridged_to_full</span>(
  <span class='no'>dt</span>,
  <span class='no'>id_cols</span>,
  <span class='no'>regression_fits</span>,
  <span class='no'>regression_id_cols</span>,
  <span class='no'>lx_spline_start_age</span>,
  <span class='no'>lx_spline_end_age</span>,
  <span class='kw'>preserve_input_ax_ages</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>0</span>, <span class='fu'><a href='https://rdrr.io/r/base/Extremes.html'>max</a></span>(<span class='no'>dt</span>$<span class='no'>age_start</span>))
)</pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>dt</th>
      <td><p>[<code>data.table()</code>]<br /> Abridged life tables with variables
'age_start', 'age_end', all <code>id_cols</code>, 'qx', 'ax'</p></td>
    </tr>
    <tr>
      <th>id_cols</th>
      <td><p>[<code><a href='https://rdrr.io/r/base/character.html'>character()</a></code>]<br /> Variables that uniquely identify rows,
must include 'age_start' and 'age_end'.</p></td>
    </tr>
    <tr>
      <th>regression_fits</th>
      <td><p>[<code>data.table()</code>]<br /> Abridged to full regression
parameters. Columns include all <code>regression_id_cols</code>, 'intercept', 'slope'.</p></td>
    </tr>
    <tr>
      <th>regression_id_cols</th>
      <td><p>[<code><a href='https://rdrr.io/r/base/character.html'>character()</a></code>]<br /> Variables that uniquely
identify regression parameters. Must include 'age_start' and 'age_end' and
be contained by <code>id_cols</code>.</p></td>
    </tr>
    <tr>
      <th>lx_spline_start_age</th>
      <td><p>[<code><a href='https://rdrr.io/r/base/integer.html'>integer(1)</a></code>]<br /> Age (inclusive) to start using
lx spline rather than regression fits. Use 0 to use lx spline for all ages,
or Inf to use regression results for all. Corresponds to 'age_start' column.</p></td>
    </tr>
    <tr>
      <th>lx_spline_end_age</th>
      <td><p>[<code><a href='https://rdrr.io/r/base/integer.html'>integer(1)</a></code>]<br /> Age (non-inclusive) to end spline
and begin using regression fits. Corresponds to 'age_start' column.</p></td>
    </tr>
    <tr>
      <th>preserve_input_ax_ages</th>
      <td><p>[<code><a href='https://rdrr.io/r/base/integer.html'>integer()</a></code>]<br /> Ages to preserve the input
ax values for. This is typically the first age group 0-1 and the terminal
age group. Corresponds to 'age_start' column.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>[<code>data.table()</code>]<br /> Full (single-year) life tables with columns
<code>id_cols</code>, 'age', 'qx', 'ax'.</p>
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>This function includes two different methods for expanding
abridged life tables to full life tables. The first method is a
<strong>monotonic cubic spline</strong> over lx. Because lx is always decreasing, the
monotonic spline fits the general curve and pattern well, basically
splining between the knots at each abridged-year increment. However, the
spline can become wild and unreasonable in age groups with dramatic changes
in mortality rate over age. Internally, this function calls the function
<code><a href='https://rdrr.io/r/stats/splinefun.html'>stats::spline()</a></code>.</p>
<p>The second method is a <strong>regression method</strong> to predict log full qx from
log abridged qx:
$$log(qx) = B0 + B1 log(qx,abridged)$$
Where the parameters \(B0\) and \(B1\) are fit using high
quality single-year life tables (like those from Human Mortality Database),
and passed into this function. The regression must be fit separately by
single-year age, but it may be also stratified by secondary identifying
variables like 'sex'. These regression id variables must be present in the
input abridged life tables you are trying to expand. The regression-based
method has its own challenges, where jagged qx patterns may arise because
we do not take consecutive abridged qx values into account simultaneously.</p>
<p>The function also allows for a combination of the methods to be used, with
separation on age. The age cutoffs we found to work best are: regression
method for ages &lt;15 and &gt;100 and spline method for ages between 15 and 100.
This corresponds to <code>lx_spline_start_age = 15</code> and
<code>lx_spline_end_age = 100</code>.</p>
    <h2 class="hasAnchor" id="default-ax"><a class="anchor" href="#default-ax"></a>Default ax</h2>

    

<p>Values of ax are assumed to be 0.5 for all single-year ages, except those
passed into <code>preserve_input_ax_ages</code> argument. HMD also assumes 0.5 for
single-years, but we may be introducing an inconsistency between abridged
and full life table mx values that are calculated from these differing ax
values. Therefore, this is an area for future methods development.</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span>(<span class='st'>"exampleLT"</span>)
<span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span>(<span class='st'>"fullLTpars"</span>)
<span class='no'>regression_fits</span> <span class='kw'>&lt;-</span> <span class='no'>fullLTpars</span>[<span class='no'>sex</span> <span class='kw'>==</span> <span class='st'>"female"</span>]
<span class='no'>id_cols</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"age_start"</span>, <span class='st'>"age_end"</span>)
<span class='no'>dt</span> <span class='kw'>&lt;-</span> <span class='fu'>abridged_to_full</span>(
  <span class='kw'>dt</span> <span class='kw'>=</span> <span class='no'>exampleLT</span>, <span class='kw'>regression_fits</span> <span class='kw'>=</span> <span class='no'>regression_fits</span>, <span class='kw'>id_cols</span> <span class='kw'>=</span> <span class='no'>id_cols</span>,
  <span class='kw'>lx_spline_start_age</span> <span class='kw'>=</span> <span class='fl'>15</span>, <span class='kw'>lx_spline_end_age</span> <span class='kw'>=</span> <span class='fl'>100</span>,
  <span class='kw'>regression_id_cols</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"age_start"</span>, <span class='st'>"age_end"</span>)
)</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Katie Paulson, Grant Nguyen, Charlton Callender, Spencer Pease, Haidong Wang, Institute for Health Metrics and Evaluation.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.0.9000.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


